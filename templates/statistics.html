{% extends 'base.html' %}
{% load static %}

{% block title %}Statistics{% endblock %}


{% block cdn %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}


{% block content %}
  <h2 class="my-5 text-center">Statistics on the time spent observing</h2>

  <div class="row row-cols-1 row-cols-lg-2">
    <div class="col">
      <div class="chart-card py-3">
        <h5 class="mb-4 text-center">Category</h5>
        <canvas id="chart-category" class="px-2"></canvas>
      </div>
    </div>
    <div class="col">
      <div class="chart-card py-3">
        <h5 class="mb-4 text-center">Solar System</h5>
        <canvas id="chart-solar-system" class="px-2"></canvas>
      </div>
    </div>
  </div>
{% endblock %}


{% block script %}
  <script>
    function loadChart(chart, endpoint) {
      $.ajax({
        url: endpoint,
        type: 'GET',
        dataType: 'json',
        success: (jsonResponse) => {

          const labels = jsonResponse.data.labels;
          const tooltips = jsonResponse.tooltips;
          const datasets = jsonResponse.data.datasets;

          // Load data into the chart
          chart.data.labels = labels;
          datasets.forEach(dataset => {
            chart.data.datasets.push(dataset);
          });
          chart.options.plugins.tooltip.callbacks.label = function(context) {
            return tooltips[context.dataIndex];
          };

          chart.update();
        },
        error: () => console.log('Failed to fetch chart data from ' + endpoint + '.'),
      });
    }

    $(document).ready(function() {
      loadChart(categoryDurationChart, '{% url 'chart_category_duration' %}');
      loadChart(solarSystemDurationChart, '{% url 'chart_solarsystem_duration' %}');
    });

    var categoryDurationCtx = document.getElementById('chart-category');
    var categoryDurationChart = new Chart(categoryDurationCtx, {
      type: 'bar',
      options: {
        indexAxis: 'y',
        responsive: true,
        plugins: {
          tooltip: {
            displayColors: false
          }
        }
      }
    });

    var solarSystemDurationCtx = document.getElementById('chart-solar-system');
    var solarSystemDurationChart = new Chart(solarSystemDurationCtx, {
      type: 'bar',
      options: {
        indexAxis: 'y',
        responsive: true,
        plugins: {
          tooltip: {
            displayColors: false
          }
        }
      }
    });
  </script>
{% endblock %}
